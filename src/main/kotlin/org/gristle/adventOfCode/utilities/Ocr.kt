package org.gristle.adventOfCode.utilities

private val letterForms = buildMap<String, Char> {
    // 6 height letters
    put("#####...#..#..#..######.", 'A')
    put("#######..#.##..#.#.##.#.", 'B')
    put(".####.#....##....#.#..#.", 'C')
    put("#######..#.##..#.##....#", 'E')
    put("######...#.#...#.#.....#", 'F')
    put(".####.#....##.#..####.#.", 'G')
    put("######...#.....#..######", 'H')
    put("#....########....#", 'I')
    put(".#....#.....#....#.#####", 'J')
    put("######...#...##.#.#....#", 'K')
    put("#######.....#.....#.....", 'L')
    put(".####.#....##....#.####.", 'O')
    put("######..#..#..#..#...##.", 'P')
    put("######..#..#.##..##..##.", 'R')
    put("#..##.#.#..##.#..#.#...#", 'S')
    put(".######.....#......#####", 'U')
    put("....##...#..###......#......##", 'Y')
    put("##...##.#..##..#.##...##", 'Z')
    // 10 height letters
    put("########......#...#.....#....#....#....#....#...#.########..", 'A')
    put("###########....#...##....#...##....#...##....#...#.####.###.", 'B')
    put(".########.#........##........##........##........#.#......#.", 'C')
    put("###########....#...##....#...##....#...##....#...##........#", 'E')
    put("##########.....#...#.....#...#.....#...#.....#...#.........#", 'F')
    put(".########.#........##........##...#....#.#..#....######...#.", 'G')
    put("##########.....#.........#.........#.........#....##########", 'H')
    put(".##.......#.........#.........#........#.#########.........#", 'J')
    put("##########....##.......#..#.....#....#...#......#.#........#", 'K')
    put("###########.........#.........#.........#.........#.........", 'L')
    put("##########.......##......##......##......##.......##########", 'N')
    put("##########.....#...#.....#...#.....#...#.....#...#......###.", 'P')
    put("##########.....#...#.....#...#....##...#..##.#...###....###.", 'R')
    put("##......##..##..##......##........##......##..##..##......##", 'X')
    put("###......##..#.....##...#....##....#...##.....#..##......###", 'Z')
}

fun Grid<Char>.ocr() = rotate90()
    .addRight(Grid(width, 1) { '\n' })
    .joinToString("")
    .replace(' ', '.')
    .replace("....##\n...#..\n###...\n...#..\n....##", "....##\n...#..\n###...\n...#..\n....##\n......\n")
    .split("""^(\.{6,}\n)+""".toRegex(RegexOption.MULTILINE))
    .filter { it.isNotBlank() }
    .map { it.replace("\n", "") }
    .map { letterForms[it] ?: '?' }
    .joinToString("")

@JvmName("ocrBoolean")
fun Grid<Boolean>.ocr() = mapToGrid { if (it) '#' else '.' }.ocr() 

fun String.ocr() = toGrid().ocr()